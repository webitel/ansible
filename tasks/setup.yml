---
# Common roles for all hosts

- name: 'Updates apt cache & upgrades dist'
  apt:
    upgrade: 'yes'
    update_cache: 'yes'
  when: ansible_distribution == 'Debian'

- name: 'Install all necessary software with APT'
  apt:
    name: '{{ software }}'
    state: latest
  when: ansible_distribution == 'Debian'

- locale_gen:
    name: '{{ item }}'
    state: present
  with_items:
    - '{{ locales_gen }}'
  when: ansible_distribution == 'Debian'

- sysctl:
    name: net.ipv6.conf.all.disable_ipv6
    value: '1'
    sysctl_set: yes
    state: present
    reload: yes

- sysctl:
    name: net.ipv6.conf.default.disable_ipv6
    value: '1'
    sysctl_set: yes
    state: present
    reload: yes

- sysctl:
    name: net.ipv6.conf.lo.disable_ipv6
    value: '1'
    sysctl_set: yes
    state: present
    reload: yes

- sysctl:
    name: fs.file-max
    value: '1000000'
    sysctl_set: yes
    state: present
    reload: yes

- sysctl:
    name: vm.max_map_count
    value: '262144'
    sysctl_set: yes
    state: present
    reload: yes
